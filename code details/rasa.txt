data/config.yml

language: en
recipe: default.v1
pipeline:
- name: WhitespaceTokenizer
- name: RegexFeaturizer
- name: LexicalSyntacticFeaturizer
- name: CountVectorsFeaturizer
- name: CountVectorsFeaturizer
  analyzer: char_wb
  min_ngram: 1
  max_ngram: 4
- name: DIETClassifier
  epochs: 100
- name: EntitySynonymMapper
- name: DucklingEntityExtractor
  url: http://localhost:8008
  dimensions:
  - time
  - date
  - number
  locale: en_US
- name: FallbackClassifier
  threshold: 0.6
  ambiguity_threshold: 0.1
policies:
- name: MemoizationPolicy
- name: RulePolicy
- name: TEDPolicy
  max_history: 5
  epochs: 100
assistant_id: 20251104-103252-binary-process




data/credentials.yml

rest:



data/domain.yml

version: "3.1"

intents:
  - greet
  - goodbye
  - affirm
  - deny
  - show_options
  - register_user
  - log_in_user
  - forgotten_id
  - book_appointment
  - check_appointments
  - reschedule_appointment
  - cancel_appointment
  - ask_insurance
  - ask_medical_info
  - contact_physician
  - inform_name
  - inform_email
  - inform_phone
  - inform_patient_id
  - inform_doctor_name
  - inform_time
  - skip_info
  - thanks
  - mood_bad
  - nlu_fallback

entities:
  - patient_id
  - patient_name
  - patient_email
  - patient_phone
  - doctor_name
  - medical_topic
  - symptom
  - date
  - time
  - number

slots:
  patient_id:
    type: text
    influence_conversation: true
    mappings: 
    - type: from_entity
      entity: patient_id
    - type: from_text
      intent: inform_patient_id
  
  user_name:
    type: text
    influence_conversation: true
    mappings: []
    
  user_context:
    type: text
    influence_conversation: true
    mappings: []

  patient_name:
    type: text
    influence_conversation: false
    mappings: 
    - type: from_entity
      entity: patient_name
    - type: from_text
      conditions: [{active_loop: simple_info_form, requested_slot: patient_name}]

  patient_email:
    type: text
    influence_conversation: false
    mappings: 
    - type: from_entity
      entity: patient_email
    - type: from_text
      conditions: [{active_loop: simple_info_form, requested_slot: patient_email}]
    - type: from_text
      conditions: [{active_loop: lookup_form, requested_slot: patient_email}]
  
  patient_phone:
    type: text
    influence_conversation: false
    mappings: 
    - type: from_entity
      entity: patient_phone
    - type: from_text
      conditions: [{active_loop: simple_info_form, requested_slot: patient_phone}]

  doctor_name:
    type: text
    influence_conversation: false
    mappings: 
    - type: from_entity
      entity: doctor_name
    - type: from_intent
      intent: skip_info
      value: 'First Available'

  department:
    type: text
    influence_conversation: false
    mappings: []

  appointment_date:
    type: text
    influence_conversation: false
    mappings:
    - type: from_entity
      entity: time
      conditions:
      - active_loop: appointment_form
        requested_slot: appointment_date
  
  appointment_time:
    type: text
    influence_conversation: false
    mappings: 
    - type: from_entity
      entity: time
      intent: inform_time
    - type: from_entity
      entity: time
      conditions:
      - active_loop: appointment_form
        requested_slot: appointment_time
    
  appointment_reason:
    type: text
    influence_conversation: false
    mappings: 
    - type: from_text
      conditions: [{active_loop: appointment_form, requested_slot: appointment_reason}]

  medical_query:
    type: text
    influence_conversation: false
    mappings: 
    - type: from_text
      conditions: [{active_loop: medical_form, requested_slot: medical_query}]

  insurance_query:
    type: text
    influence_conversation: false
    mappings: 
    - type: from_text
      conditions: [{active_loop: insurance_form, requested_slot: insurance_query}]
  
  message_content:
    type: text
    influence_conversation: false
    mappings: 
    - type: from_text
      conditions: [{active_loop: physician_form, requested_slot: message_content}]

  requested_slot:
    type: text
    influence_conversation: false
    mappings: []

actions:
  - action_session_start
  - action_restart_conversation
  - action_suggest_next_steps
  - action_create_new_patient
  - action_login_patient
  - action_lookup_patient_id
  - action_submit_appointment
  - action_llm_response
  - action_rag_insurance_query
  - action_send_physician_message
  - action_reschedule_cancel
  - action_show_appointments
  - validate_simple_info_form
  - validate_appointment_form
  - validate_lookup_form
  - validate_physician_form
  - validate_medical_form
  - validate_insurance_form

forms:
  simple_info_form:
    required_slots:
      - patient_name
      - patient_email
      - patient_phone
  appointment_form:
    required_slots:
      - appointment_reason
      - doctor_name
      - appointment_date
      - appointment_time
  lookup_form:
    required_slots:
      - patient_email
  physician_form:
    required_slots:
      - doctor_name
      - message_content
  medical_form:
    required_slots:
      - medical_query
  insurance_form:
    required_slots:
      - insurance_query

# --- [START] DUPLICATE QUESTION FIX ---
# We REMOVE the utter_ask_... responses for the
# medical_form and insurance_form. The custom
# validation actions now handle all questions.
responses:
  utter_greet:
    - text: "Hello! I am your advanced Healthcare Assistant ðŸ¤–. How can I assist you today?"
      buttons:
      - title: "Register/Login"
        payload: "/show_options"
      - title: "Ask a Health Question"
        payload: "/ask_medical_info"
  utter_ask_account_type:
    - text: "Do you need to register as a new patient or log in to view existing details?"
      buttons:
      - title: "I am new"
        payload: "/register_user"
      - title: "I have an ID"
        payload: "/log_in_user"
  utter_ask_patient_id:
    - text: "Welcome back! Please enter your Patient ID."
      buttons:
      - title: "Forgot my ID"
        payload: "/forgotten_id"
  utter_goodbye:
    - text: "Thank you for using the Healthcare Assistant. Goodbye!"
  utter_default_fallback:
    - text: "I'm not sure how to handle that request. I'm transferring you to general medical information."
  utter_mood_bad_response:
    - text: "I hear you, and itâ€™s important to acknowledge how you feel. I am a bot, but I care. Please consider contacting a professional crisis line or support service immediately. I can provide the number for a mental health helpline if you need it."
# --- [END] DUPLICATE QUESTION FIX ---



data/endpoints.yml

# This file connects Rasa to your custom actions and other services.

# --- CRITICAL FIX ---
# This tells Rasa to send all action execution requests
# (e.g., 'action_create_new_patient') to our *single* FastAPI
# backend at the '/rasa/webhook' endpoint we created.
# This ELIMINATES the old 'rasa run actions' server.
action_endpoint:
  url: "http://localhost:8000/rasa/webhook"

# Endpoint for the Duckling entity extractor (dates, times)
duckling:
  url: "http://localhost:8008"


data/nlu.yml

version: "3.1"

nlu:
# --- CORE GREETING & ORCHESTRATION ---
- intent: greet
  examples: |
    - hello
    - hi
    - good morning
    - hey there
    - /greet

- intent: goodbye
  examples: |
    - bye
    - goodbye
    - see you later
    - gotta go

- intent: affirm
  examples: |
    - yes
    - yeah
    - absolutely
    - confirm

- intent: deny
  examples: |
    - no
    - nope
    - never
    - cancel that

- intent: show_options
  examples: |
    - what can you do
    - main menu
    - show my options
    - go back

# --- ACCOUNT FLOWS (Trigger Forms) ---
- intent: register_user
  examples: |
    - I want to register
    - I'm new here
    - sign me up

- intent: log_in_user
  examples: |
    - I want to log in
    - I am an existing patient
    - existing user
    
- intent: forgotten_id
  examples: |
    - I forgot my patient ID
    - help me retrieve my ID
    - look up my patient ID

# --- TRANSACTIONAL FLOWS ---
- intent: book_appointment
  examples: |
    - I need to book an appointment
    - schedule a visit
    - see a doctor

# --- [START] NEW INTENT ---
- intent: check_appointments
  examples: |
    - check my appointments
    - do I have any appointments?
    - show my visits
    - what appointments do I have
    - /check_appointments
# --- [END] NEW INTENT ---

- intent: reschedule_appointment
  examples: |
    - I need to change my appointment time
    - reschedule my visit
    
- intent: cancel_appointment
  examples: |
    - cancel my appointment
    - I need to cancel my visit

# --- KNOWLEDGE & ASSISTANCE FLOWS ---
- intent: ask_insurance
  examples: |
    - What does my plan cover?
    - I have a question about my copay
    - check my insurance
    - /ask_insurance

- intent: ask_medical_info
  examples: |
    - What are the [symptoms](medical_topic) of [flu](medical_topic)?
    - Tell me about [hypertension](medical_topic).
    - What are the common [side effects](medical_topic) of [ibuprofen](medical_topic)?
    - I have a [bad cough](symptom) and a [fever](symptom)
    - ask a health question
    - /ask_medical_info

- intent: contact_physician
  examples: |
    - I need to message my doctor
    - send a note to Dr. [Smith](doctor_name)
    - contact my physician
    - /contact_physician

# --- SLOT CARRY-OVER / ENTITY INJECTION ---
- intent: inform_name
  examples: |
    - My name is [Sarah Connor](patient_name)
    - [James T Kirk](patient_name)
    
- intent: inform_email
  examples: |
    - My email is [user@example.com](patient_email)
    - [test@test.com](patient_email)

- intent: inform_phone
  examples: |
    - my phone number is [5551234567](patient_phone)
    - [555-987-6543](patient_phone)
    
- intent: inform_doctor_name
  examples: |
    - I want to see Dr. [Emily Jones](doctor_name)
    - [Dr. Chang](doctor_name)
    - /inform_doctor_name{"doctor_name": "Dr. Anya Sharma"}
    - /inform_doctor_name{"doctor_name": "Dr. Ben Carter"}
    - /inform_doctor_name{"doctor_name": "Dr. Chloe Li"}

- intent: skip_info
  examples: |
    - skip
    - N/A
    - I don't know
    - no preference
    - yes
    - ok
    - okay
    - sure
    - fine
    - that works
    - yes please
    - first available
    - Dr. First Available
    - /skip_info

# --- MISCELLANEOUS ---
- intent: thanks
  examples: |
    - thank you
    - thanks
    - ok thanks

- intent: mood_bad
  examples: |
    - I feel very sad
    - I am having a hard time
    - I feel stressed
    
- intent: nlu_fallback
  examples: |
    - asdfghjkl
    - qwertyuiop
    - what in the world is that?

- intent: inform_patient_id
  examples: |
    - PID-1234ABCD
    - 76FFB08C
    - my id is A053DFBD
    - PID-2B5B95B8
    - 12345678
    - ABC123ZYX
    - its 76FFB08C
    - PID-A053DFBD

- intent: inform_time
  examples: |
    - /inform_time{"time":"09:00"}
    - /inform_time{"time":"10:30"}
    - /inform_time{"time":"14:00"}


data/rules.yml

version: "3.1"

rules:
# -------------------------------------------------------------------------
# CORE FLOW 1: GREET & RESTART
# -------------------------------------------------------------------------
- rule: Handle session start
  steps:
  - action: action_session_start
  - action: action_suggest_next_steps

- rule: Greet user
  steps:
  - intent: greet
  - action: action_suggest_next_steps

- rule: Execute the Proactive Suggestion Action (Main Menu)
  steps:
  - intent: show_options
  - action: action_suggest_next_steps

- rule: Listen after main menu is shown
  steps:
  - action: action_suggest_next_steps
  - action: action_listen

# -------------------------------------------------------------------------
# CORE FLOW 2: REGISTRATION (simple_info_form)
# -------------------------------------------------------------------------
- rule: Activate Registration Form
  steps:
  - intent: register_user
  - action: simple_info_form
  - active_loop: simple_info_form
 
- rule: Submit Registration Form
  condition:
  - active_loop: simple_info_form
  steps:
  - action: simple_info_form
  - active_loop: null
  - action: action_create_new_patient

# -------------------------------------------------------------------------
# CORE FLOW 3: LOGIN / LOOKUP (lookup_form)
# -------------------------------------------------------------------------
- rule: Existing User initiates login
  steps:
  - intent: log_in_user
  - action: utter_ask_patient_id

- rule: Validate Patient ID when provided
  steps:
  - intent: inform_patient_id
  - action: action_login_patient

- rule: Activate ID Lookup Form
  steps:
  - intent: forgotten_id
  - action: lookup_form
  - active_loop: lookup_form
  
- rule: Submit Lookup Form
  condition:
  - active_loop: lookup_form
  steps:
  - action: lookup_form
  - active_loop: null
  - action: action_lookup_patient_id

# -------------------------------------------------------------------------
# TRANSACTIONAL FLOWS
# -------------------------------------------------------------------------
- rule: Activate Appointment Form
  steps:
  - intent: book_appointment
  - action: appointment_form
  - active_loop: appointment_form

- rule: Submit Appointment Form
  condition:
  - active_loop: appointment_form
  steps:
  - action: appointment_form
  - active_loop: null
  - action: action_submit_appointment

- rule: Show user's appointments
  steps:
  - intent: check_appointments
  - action: action_show_appointments

- rule: Reschedule/Cancel is not yet implemented
  steps:
  - or:
    - intent: reschedule_appointment
    - intent: cancel_appointment
  - action: action_reschedule_cancel

# -------------------------------------------------------------------------
# KNOWLEDGE FLOWS (ALL NEW/FIXED)
# -------------------------------------------------------------------------
- rule: Activate Insurance Form
  steps:
  - intent: ask_insurance
  - action: insurance_form
  - active_loop: insurance_form

- rule: Submit Insurance Form
  condition:
  - active_loop: insurance_form
  steps:
  - action: insurance_form
  - active_loop: null
  - action: action_rag_insurance_query

- rule: Activate Medical Form
  steps:
  - intent: ask_medical_info
  - action: medical_form
  - active_loop: medical_form
  
- rule: Submit Medical Form
  condition:
  - active_loop: medical_form
  steps:
  - action: medical_form
  - active_loop: null
  - action: action_llm_response

- rule: Trigger Contact Physician flow
  steps:
  - intent: contact_physician
  - action: physician_form
  - active_loop: physician_form
  
- rule: Submit Physician Form
  condition:
  - active_loop: physician_form
  steps:
  - action: physician_form
  - active_loop: null
  - action: action_send_physician_message

# -------------------------------------------------------------------------
# GENERAL & FALLBACK
# -------------------------------------------------------------------------
- rule: Mood Check (Overrides NLU Fallback)
  steps:
  - intent: mood_bad
  - action: utter_mood_bad_response
  - action: action_suggest_next_steps

# --- [START] UPDATED FALLBACK RULE ---
# The bad 'slot_set' line has been removed.
- rule: Catchall Fallback to LLM
  condition:
  - active_loop: null # Only trigger if no form is active
  steps:
  - intent: nlu_fallback
  - action: action_llm_response
# --- [END] UPDATED FALLBACK RULE ---

- rule: Say thanks and return options
  steps:
  - intent: thanks
  - action: action_suggest_next_steps

- rule: Say goodbye
  steps:
  - intent: goodbye
  - action: utter_goodbye


data/stories.yml

version: "3.1"

stories:
# This file is intentionally EMPTY. 
# Our advanced chatbot relies entirely on rules (rules.yml) and custom actions 
# for stable, production-level dialogue management and form filling.
# Keeping this file empty prevents conflicts and errors during training.