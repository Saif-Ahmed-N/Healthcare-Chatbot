index.html


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Healthcare Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <style>
        html, body { font-family: 'Inter', sans-serif; }
        #chat-container::-webkit-scrollbar { width: 6px; }
        #chat-container::-webkit-scrollbar-track { background: transparent; }
        #chat-container::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        
        .message {
            max-width: 85%; padding: 12px 16px; border-radius: 12px;
            line-height: 1.5; margin-top: 6px; margin-bottom: 6px; animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .typing-indicator span {
            height: 6px; width: 6px; background-color: #94a3b8; border-radius: 50%; display: inline-block;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1.0); } }

        .message-buttons { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px; }
        .message-btn {
            background-color: white; color: #2563eb; border: 1px solid #bfdbfe;
            padding: 8px 16px; border-radius: 9999px; font-weight: 500; font-size: 0.9rem;
            transition: all 0.2s; box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .message-btn:hover:not(:disabled) { background-color: #eff6ff; border-color: #3b82f6; transform: translateY(-1px); }
        .message-btn:disabled { opacity: 0.5; cursor: not-allowed; background-color: #f1f5f9; border-color: #e2e8f0; color: #94a3b8; }

        .flatpickr-calendar { box-shadow: none !important; border: none !important; width: 100% !important; max-width: 100% !important; }
        .flatpickr-day.selected { background: #2563eb !important; border-color: #2563eb !important; }
    </style>
</head>
<body class="bg-slate-100 flex items-center justify-center min-h-screen p-4 md:p-6">

    <div class="w-full max-w-md h-[95vh] max-h-[800px] bg-white rounded-2xl shadow-xl flex flex-col overflow-hidden border border-slate-200 ring-1 ring-slate-900/5">
        
        <header class="bg-white px-5 py-4 border-b border-slate-100 flex items-center gap-3">
            <img src="assets/logo.png" 
                 alt="Healthcare Assistant Logo" 
                 class="h-10 w-10 rounded-full object-cover border border-slate-200 shadow-sm"
                 onerror="this.onerror=null; this.src='https://placehold.co/40x40/2563eb/ffffff?text=H'" />

            <div>
                <h1 class="font-semibold text-slate-800 leading-tight">Medical Assistant</h1>
                <div class="flex items-center gap-1.5">
                    <span class="relative flex h-2 w-2">
                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                        <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
                    </span>
                    <span class="text-xs font-medium text-slate-500">Online Now</span>
                </div>
            </div>
        </header>

        <main id="chat-container" class="flex-1 overflow-y-auto p-4 bg-[#fafafa] flex flex-col">
            <div id="typing-indicator" class="hidden message w-fit bg-white border border-slate-100 shadow-sm">
                <div class="typing-indicator px-1"><span></span><span></span><span></span></div>
            </div>
        </main>

        <div id="picker-container" class="hidden bg-white border-t border-slate-100 transition-all duration-300 ease-in-out"></div>
        
        <form id="input-form" class="bg-white p-3 flex items-end gap-2 border-t border-slate-100">
            <button id="go-back-btn" type="button" class="mb-1.5 p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-full transition" title="Main Menu">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M17 10a.75.75 0 01-.75.75H5.612l4.158 3.96a.75.75 0 11-1.04 1.08l-5.5-5.25a.75.75 0 010-1.08l5.5-5.25a.75.75 0 111.04 1.08L5.612 9.25H16.25A.75.75 0 0117 10z" clip-rule="evenodd" /></svg>
            </button>
            <div class="flex-1 relative">
                <textarea id="message-input" rows="1" class="w-full py-3 px-4 bg-slate-100 border-0 rounded-[1.5rem] outline-none focus:ring-2 focus:ring-blue-500/50 resize-none max-h-32 text-slate-700 placeholder:text-slate-400" placeholder="Type a message..."></textarea>
            </div>
            <button type="submit" class="mb-1.5 h-10 w-10 bg-blue-600 hover:bg-blue-700 text-white rounded-full flex items-center justify-center transition shrink-0 shadow-sm active:scale-95">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 translate-x-px"><path d="M3.105 2.289a.75.75 0 00-.826.95l1.414 4.925A1.5 1.5 0 005.135 9.25h6.115a.75.75 0 010 1.5H5.135a1.5 1.5 0 00-1.442 1.086l-1.414 4.926a.75.75 0 00.826.95 28.896 28.896 0 0015.293-7.154.75.75 0 000-1.115A28.897 28.897 0 003.105 2.289z" /></svg>
            </button>
        </form>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const chatContainer = document.getElementById("chat-container");
            const inputForm = document.getElementById("input-form");
            const messageInput = document.getElementById("message-input");
            const typingIndicator = document.getElementById("typing-indicator");
            const goBackBtn = document.getElementById("go-back-btn");
            const pickerContainer = document.getElementById("picker-container");
            
            let fpInstance = null;
            let lastBotMessageElement = null;
            const API_URL = "http://localhost:8000/chat"; 
            const SENDER_ID = "user_" + Math.random().toString(36).substring(7);

            const payloadToText = {
                "/greet": "Hello", "/show_options": "Main Menu", "/register_user": "Register New Account",
                "/log_in_user": "Log In", "/book_appointment": "Book Appointment",
                "/check_appointments": "My Appointments", "/ask_medical_info": "General Health Q&A",
                "/ask_insurance": "Insurance Help", "/contact_physician": "Message Doctor"
            };

            function scrollToBottom() { chatContainer.scrollTop = chatContainer.scrollHeight; }
            function showTyping(show) {
                typingIndicator.classList.toggle("hidden", !show);
                if (show) { chatContainer.appendChild(typingIndicator); scrollToBottom(); }
            }
            function addMessage(text, sender = "bot") {
                const msgDiv = document.createElement("div");
                msgDiv.className = `message w-fit shadow-sm ${sender === "bot" ? "self-start bg-white text-slate-700 border border-slate-100 rounded-tl-none" : "self-end bg-blue-600 text-white rounded-br-none"}`;
                msgDiv.innerHTML = text.replace(/\*\*(.*?)\*\*/g, '<strong class="font-semibold">$1</strong>').replace(/\n/g, '<br>');
                chatContainer.insertBefore(msgDiv, typingIndicator);
                if (sender === "bot") lastBotMessageElement = msgDiv;
                scrollToBottom();
            }
            function addButtons(buttons) {
                if (!buttons?.length || !lastBotMessageElement) return;
                const btnContainer = document.createElement("div");
                btnContainer.className = "message-buttons";
                buttons.forEach(({ title, payload }) => {
                    const btn = document.createElement("button");
                    btn.className = "message-btn";
                    btn.textContent = title;
                    btn.onclick = () => handleButtonClick(title, payload);
                    btnContainer.appendChild(btn);
                });
                lastBotMessageElement.appendChild(btnContainer);
                scrollToBottom();
            }

            function hidePicker() {
                if (fpInstance) { fpInstance.destroy(); fpInstance = null; }
                pickerContainer.innerHTML = ""; pickerContainer.classList.add("hidden");
            }
            function showCalendar() {
                hidePicker(); pickerContainer.classList.remove("hidden");
                const wrapper = document.createElement("div"); wrapper.className = "p-4 flex justify-center";
                pickerContainer.appendChild(wrapper);
                fpInstance = flatpickr(wrapper, {
                    inline: true, minDate: "today", disableMobile: "true", dateFormat: "Y-m-d",
                    onChange: (d, dateStr) => handleButtonClick(dateStr, dateStr)
                });
                scrollToBottom();
            }
            function showTimePicker(availableTimes) {
                hidePicker(); pickerContainer.classList.remove("hidden");
                const wrapper = document.createElement("div"); wrapper.className = "p-5";
                const header = document.createElement("h3");
                header.className = "text-sm font-semibold text-slate-500 uppercase tracking-wider mb-3 text-center";
                header.textContent = "Select Available Time";
                wrapper.appendChild(header);
                const grid = document.createElement("div");
                grid.className = "grid grid-cols-3 gap-3 max-h-[220px] overflow-y-auto pr-1";
                availableTimes.forEach(time24 => {
                    const [h, m] = time24.split(":");
                    const hour = parseInt(h, 10);
                    const ampm = hour >= 12 ? "PM" : "AM";
                    const hour12 = hour % 12 || 12;
                    const timeDisplay = `${hour12}:${m} ${ampm}`;
                    const btn = document.createElement("button");
                    btn.textContent = timeDisplay;
                    btn.className = "py-2.5 text-sm font-medium text-slate-700 border border-slate-300 rounded-lg hover:border-blue-600 hover:bg-blue-50 hover:text-blue-700 transition active:scale-95 active:bg-blue-600 active:text-white";
                    btn.onclick = () => handleButtonClick(timeDisplay, `/inform{"appointment_time":"${time24}"}`);
                    grid.appendChild(btn);
                });
                wrapper.appendChild(grid); pickerContainer.appendChild(wrapper); scrollToBottom();
            }

            async function handleButtonClick(title, payload) {
                document.querySelectorAll('.message-btn').forEach(b => b.disabled = true);
                hidePicker();
                addMessage(payloadToText[payload] || title, "user");
                showTyping(true);
                await sendMessageToBackend(payload);
            }
            async function sendMessageToBackend(messageText) {
                try {
                    const response = await fetch(API_URL, {
                        method: "POST", headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ sender: SENDER_ID, message: messageText }),
                    });
                    if (!response.ok) throw new Error(response.statusText);
                    const data = await response.json();
                    showTyping(false);
                    data.forEach(res => {
                        if (res.text) addMessage(res.text, "bot");
                        if (res.buttons) addButtons(res.buttons);
                        if (res.custom?.calendar) showCalendar();
                        if (res.custom?.time_picker) showTimePicker(res.custom.available_times);
                    });
                } catch (error) {
                    showTyping(false); console.error("Chat Error:", error);
                    addMessage("⚠️ Network error. Please check your connection.", "bot");
                }
            }

            inputForm.addEventListener("submit", (e) => {
                e.preventDefault(); const msg = messageInput.value.trim(); if (!msg) return;
                messageInput.value = ""; messageInput.style.height = 'auto';
                addMessage(msg, "user"); showTyping(true); sendMessageToBackend(msg);
            });
            messageInput.addEventListener('input', function() { this.style.height = 'auto'; this.style.height = (this.scrollHeight) + 'px'; });
            messageInput.addEventListener('keydown', (e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); inputForm.requestSubmit(); } });
            goBackBtn.addEventListener("click", () => handleButtonClick("Main Menu", "/show_options"));
            
            showTyping(true); sendMessageToBackend("/greet");
        });
    </script>
</body>
</html>